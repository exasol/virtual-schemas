<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Strict//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>/home/seb/git/virtual-schemas/doc/development/.developing_a_dialect.md.html</title>


<style type="text/css">
body {
	color: #333;
	font: 13px/1.4 "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
	padding: 0;
	margin: 0;
}

a {
	background: transparent;
	color: #4183c4;
	text-decoration: none;
}

a:active,
a:hover {
	outline: 0 none;
	text-decoration: underline;
}

abbr[title] {
	border-bottom: 1px dotted;
}

b,
strong {
	font-weight: bold;
}

dfn {
	font-style: italic;
}
h1 {
	font-size: 2em;
	margin: 0.67em 0;
}
mark {
	background: #ff0;
	color: #000;
}
small {
	font-size: 80%;
}
sub, sup {
	font-size: 75%;
	line-height: 0;
	position: relative;
	vertical-align: baseline;
}
sup {
	top: -0.5em;
}
sub {
	bottom: -0.25em;
}
img {
	border: 0 none;
}
svg:not(:root) {
	overflow: hidden;
}
figure {
	margin: 1em 40px;
}
hr {
	box-sizing: content-box;
	height: 0;
}

code,
kbd,
pre,
samp {
	font-family: monospace,monospace;
	font-size: 1em;
}

pre {
	overflow: auto;
	font: 12px Consolas,"Liberation Mono",Menlo,Courier,monospace;
	margin-bottom: 0;
	margin-top: 0;
}

.markdown-body {
	padding: 30px;
	font-size: 16px;
	line-height: 1.6;
	word-wrap: break-word;
}

.markdown-body>*:first-child {
	margin-top: 0 !important;
}

.markdown-body>*:last-child {
	margin-bottom: 0 !important;
}

.markdown-body .absent {
	color: #c00;
}

.markdown-body .anchor {
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	display: block;
	padding-right: 6px;
	padding-left: 30px;
	margin-left: -30px;
}

.markdown-body .anchor:focus {
	outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
	position: relative;
	margin-top: 1em;
	margin-bottom: 16px;
	font-weight: bold;
	line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
	display: none;
	color: #000;
	vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
	padding-left: 8px;
	margin-left: -30px;
	line-height: 1;
	text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
	display: inline-block;
}

.markdown-body h1 tt,
.markdown-body h1 code,
.markdown-body h2 tt,
.markdown-body h2 code,
.markdown-body h3 tt,
.markdown-body h3 code,
.markdown-body h4 tt,
.markdown-body h4 code,
.markdown-body h5 tt,
.markdown-body h5 code,
.markdown-body h6 tt,
.markdown-body h6 code {
	font-size: inherit;
}

.markdown-body h1 {
	padding-bottom: 0.3em;
	font-size: 2.25em;
	line-height: 1.2;
	border-bottom: 1px solid #eee;
}

.markdown-body h2 {
	padding-bottom: 0.3em;
	font-size: 1.75em;
	line-height: 1.225;
	border-bottom: 1px solid #eee;
}

.markdown-body h3 {
	font-size: 1.5em;
	line-height: 1.43;
}

.markdown-body h4 {
	font-size: 1.25em;
}

.markdown-body h5 {
	font-size: 1em;
}

.markdown-body h6 {
	font-size: 1em;
	color: #777;
}

.markdown-body p,.markdown-body blockquote,
.markdown-body ul,.markdown-body ol,
.markdown-body dl,.markdown-body table,
.markdown-body pre {
	margin-top: 0;
	margin-bottom: 16px;
}

.markdown-body hr {
	height: 4px;
	padding: 0;
	margin: 16px 0;
	background-color: #e7e7e7;
	border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
	padding-left: 2em;
}

.markdown-body ul.no-list,
.markdown-body ol.no-list {
	padding: 0;
	list-style-type: none;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
	margin-top: 0;
	margin-bottom: 0;
}

.markdown-body li>p {
	margin-top: 16px;
}

.markdown-body dl {
	padding: 0;
}

.markdown-body dl dt {
	padding: 0;
	margin-top: 16px;
	font-size: 1em;
	font-style: italic;
	font-weight: bold;
}

.markdown-body dl dd {
	padding: 0 16px;
	margin-bottom: 16px;
}

.markdown-body blockquote {
	padding: 0 15px;
	color: #777;
	border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
	margin-top: 0;
}

.markdown-body blockquote>:last-child {
	margin-bottom: 0;
}

.markdown-body table {
	display: block;
	width: 100%;
	overflow: auto;
	word-break: normal;
	word-break: keep-all;
}

.markdown-body table th {
	font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
	padding: 6px 13px;
	border: 1px solid #ddd;
}

.markdown-body table tr {
	background-color: #fff;
	border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
	background-color: #f8f8f8;
}

.markdown-body img {
	max-width: 100%;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}

.markdown-body span.frame {
	display: block;
	overflow: hidden;
}

.markdown-body span.frame>span {
	display: block;
	float: left;
	width: auto;
	padding: 7px;
	margin: 13px 0 0;
	overflow: hidden;
	border: 1px solid #ddd;
}

.markdown-body span.frame span img {
	display: block;
	float: left;
}

.markdown-body span.frame span span {
	display: block;
	padding: 5px 0 0;
	clear: both;
	color: #333;
}

.markdown-body span.align-center {
	display: block;
	overflow: hidden;
	clear: both;
}

.markdown-body span.align-center>span {
	display: block;
	margin: 13px auto 0;
	overflow: hidden;
	text-align: center;
}

.markdown-body span.align-center span img {
	margin: 0 auto;
	text-align: center;
}

.markdown-body span.align-right {
	display: block;
	overflow: hidden;
	clear: both;
}

.markdown-body span.align-right>span {
	display: block;
	margin: 13px 0 0;
	overflow: hidden;
	text-align: right;
}

.markdown-body span.align-right span img {
	margin: 0;
	text-align: right;
}

.markdown-body span.float-left {
	display: block;
	float: left;
	margin-right: 13px;
	overflow: hidden;
}

.markdown-body span.float-left span {
	margin: 13px 0 0;
}

.markdown-body span.float-right {
	display: block;
	float: right;
	margin-left: 13px;
	overflow: hidden;
}

.markdown-body span.float-right>span {
	display: block;
	margin: 13px auto 0;
	overflow: hidden;
	text-align: right;
}

.markdown-body code,.markdown-body tt {
	padding: 0;
	padding-top: 0.2em;
	padding-bottom: 0.2em;
	margin: 0;
	font-size: 85%;
	background-color: rgba(0,0,0,0.04);
	border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after,
.markdown-body tt:before,
.markdown-body tt:after {
	letter-spacing: -0.2em;
	content: "\00a0";
}

.markdown-body code br,
.markdown-body tt br {
	display: none;
}

.markdown-body del code {
	text-decoration: inherit;
}

.markdown-body pre>code {
	padding: 0;
	margin: 0;
	font-size: 100%;
	word-break: normal;
	white-space: pre;
	background: transparent;
	border: 0;
}

.markdown-body .highlight {
	margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
	padding: 16px;
	overflow: auto;
	font-size: 85%;
	line-height: 1.45;
	background-color: #f7f7f7;
	border-radius: 3px;
}

.markdown-body .highlight pre {
	margin-bottom: 0;
	word-break: normal;
}

.markdown-body pre {
	word-wrap: normal;
}

.markdown-body pre code,
.markdown-body pre tt {
	display: inline;
	max-width: initial;
	padding: 0;
	margin: 0;
	overflow: initial;
	line-height: inherit;
	word-wrap: normal;
	background-color: transparent;
	border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after,
.markdown-body pre tt:before,
.markdown-body pre tt:after {
	content: normal;
}

.highlight .pl-coc,
.highlight .pl-entl,
.highlight .pl-entm,
.highlight .pl-eoa,
.highlight .pl-mai .pl-sf,
.highlight .pl-mm,
.highlight .pl-pdv,
.highlight .pl-sc,
.highlight .pl-som,
.highlight .pl-sr,
.highlight .pl-v,
.highlight .pl-vpf {
	color: #0086b3;
}
.highlight .pl-eoac,
.highlight .pl-mdht,
.highlight .pl-mi1,
.highlight .pl-mri,
.highlight .pl-va,
.highlight .pl-vpu {
	color: #008080;
}
.highlight .pl-c,
.highlight .pl-pdc {
	color: #b4b7b4;
	font-style: italic;
}
.highlight .pl-k,
.highlight .pl-ko,
.highlight .pl-kolp,
.highlight .pl-mc,
.highlight .pl-mr,
.highlight .pl-ms,
.highlight .pl-s,
.highlight .pl-sok,
.highlight .pl-st {
	color: #6e5494;
}
.highlight .pl-ef,
.highlight .pl-enf,
.highlight .pl-enm,
.highlight .pl-entc,
.highlight .pl-eoi,
.highlight .pl-sf,
.highlight .pl-smc {
	color: #d12089;
}
.highlight .pl-ens,
.highlight .pl-eoai,
.highlight .pl-kos,
.highlight .pl-mh .pl-pdh,
.highlight .pl-mp,
.highlight .pl-pde,
.highlight .pl-stp {
	color: #458;
}
.highlight .pl-enti {
	color: #d12089;
	font-weight: bold;
}
.highlight .pl-cce,
.highlight .pl-enc,
.highlight .pl-kou,
.highlight .pl-mq {
	color: #f93;
}
.highlight .pl-mp1 .pl-sf {
	color: #458;
	font-weight: bold;
}
.highlight .pl-cos,
.highlight .pl-ent,
.highlight .pl-md,
.highlight .pl-mdhf,
.highlight .pl-ml,
.highlight .pl-pdc1,
.highlight .pl-pds,
.highlight .pl-s1,
.highlight .pl-scp,
.highlight .pl-sol {
	color: #df5000;
}
.highlight .pl-c1,
.highlight .pl-cn,
.highlight .pl-pse,
.highlight .pl-pse .pl-s2,
.highlight .pl-vi {
	color: #a31515;
}
.highlight .pl-mb,
.highlight .pl-pdb {
	color: #df5000;
	font-weight: bold;
}
.highlight .pl-mi,
.highlight .pl-pdi {
	color: #6e5494;
	font-style: italic;
}
.highlight .pl-ms1 {
	background-color: #f5f5f5;
}
.highlight .pl-mdh,
.highlight .pl-mdi {
	font-weight: bold;
}
.highlight .pl-mdr {
	color: #0086b3;
	font-weight: bold;
}
.highlight .pl-s2 {
	color: #333;
}
.highlight .pl-ii {
	background-color: #df5000;
	color: #fff;
}
.highlight .pl-ib {
	background-color: #f93;
}
.highlight .pl-id {
	background-color: #a31515;
	color: #fff;
}
.highlight .pl-iu {
	background-color: #b4b7b4;
}
.highlight .pl-mo {
	color: #969896;
}

</style>


<script type="text/javascript">

function getDocumentScrollTop() 
{
   var res = document.body.scrollTop || document.documentElement.scrollTop || window.pageYOffset || 0;
   // alert(res);
   return res;
}

function setDocumentScrollTop(ypos) 
{
	window.scrollTo(0, ypos);
}

</script>


</head>
<body class="markdown-body">
<h1> <a id="how-to-develop-and-test-a-sql-dialect-adapter" class="anchor" href="#how-to-develop-and-test-a-sql-dialect-adapter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How To Develop and Test a SQL Dialect Adapter</h1> 
<p>This article describes how you can develop and test an SQL dialect adapter based on the Virtual Schema JDBC adapter.</p> 
<h2> <a id="content" class="anchor" href="#content" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Content</h2> 
<ul> 
 <li><a href="#developing-a-dialect">Developing a Dialect</a></li> 
 <li><a href="#integration-testing-with-containers">Integration Testing with Containers</a></li> 
</ul> 
<h2> <a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2> 
<p>Before you start writing your own SQL adapter that integrates Virtual Schemas with the SQL dialect a specific data source uses, we first need to briefly discuss how Virtual Schemas are structured in general and the JDBC adapter in particular.</p> 
<p><a href="https://www.gofpatterns.com/structural-design-patterns/structural-patterns/adapter-pattern.php" rel="nofollow">Adapters</a> (also known as wrappers) are a piece of code that enable interaction between two previously incompatible objects by planting an adapter layer in between that serves as a translator. In our case a Virtual Schema adapter implements an API defined by Exasol Virtual Schemas and translates all data accesses and type conversions between the adapted source and the Exasol database.</p> 
<p>In the case of the JDBC adapter there are <em>two</em> different adapter layers in between Exasol and the source. The first one from Exasol's perspective is the JDBC adapter which contains the common part of the translation between Exasol and a source for which a JDBC driver exists. The second layer is a SQL dialect adapter, that evens out the specialties of the source databases.</p> 
<p>The name SQL dialect adapter is derived from the non-standard implementation parts of SQL databases which are often referred to as &quot;dialects&quot; of the SQL language.</p> 
<p>As an example, PostgreSQL handles some of the data types subtly different from Exasol and the SQL dialect adapter needs to deal with those differences by implementing conversion functions.</p> 
<p>Below you can see a layer model of the Virtual Schemas when implemented with the JDBC adapter. The layers in the middle -- i.e. everything that deals with translating between the source and Exasol -- are provided in this repository.</p> 
<pre><code>.-----------------------------------------.
|  Exasol    |          Exasol            |
|   core     |----------------------------|
|            |//// Virtual Schema API ////|
|------------|----------------------------|
|            |       JDBC  Adapter        |   Common JDBC functions
|  In this   |----------------------------|
| repository |///// SQL Dialect API //////|
|            |----------------------------|
|            |    SQL Dialect Adapter     |   Even out specifics of the source database
|------------|----------------------------|
|            |///////// JDBC API /////////|
|            |----------------------------|
|            |  PostgresSQL JDBC Driver   |   JDBC compliant access to payload and metadata
|  External  |----------------------------|
|            |// PostgresSQL Native API //|
|            |----------------------------|
|            |         PostgreSQL         |   External data source
'-----------------------------------------'
</code></pre> 
<p>For more information about the structure of the Virtual Schemas check the UML diagrams provided in the directory <a href="model/.diagrams.md.html">model/diagrams</a>. You either need <a href="http://plantuml.com/" rel="nofollow">PlantUML</a> to render them or an editor that has PlamtUML preview built in.</p> 
<h2> <a id="developing-a-dialect" class="anchor" href="#developing-a-dialect" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Developing a Dialect</h2> 
<p>If you want to write an SQL dialect, you need to start by implementing the dialect adapter interfaces.</p> 
<h3> <a id="project-structure" class="anchor" href="#project-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Project Structure</h3> 
<p>This repository contains Maven sub-projects that are structured as follows.</p> 
<pre><code>jdbc-adapter                               Parent project and integration test framework
  |
  |-- virtualschema-jdbc-adapter           The actual implementation files
  |
  '-- virtualschema-jdbc-adapter-dist      Environment for creating the all-in-one adapter JAR
</code></pre> 
<h3> <a id="package-structure" class="anchor" href="#package-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Package Structure</h3> 
<p>The Java package structure of the <code>virtualschema-jdbc-adapter</code> reflects the separation into dialect-independent and dialect-specific parts.</p> 
<pre><code>com.exasol.adapter
  |
  |-- dialects                             Common code for all dialect adapters
  |     |
  |     |-- db2                            IBM DB2-specific dialect adapter implementation
  |     |
  |     |-- exasol                         Exasol-specific dialect adapter implementation
  |     |
  |     |-- hive                           Apache-Hive-specific dialect adapter implementation
  |     |
  |     '-- ...
  |
  '-- jdbc                                 Base implementation for getting metadata from JDBC
</code></pre> 
<h3> <a id="interfaces" class="anchor" href="#interfaces" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interfaces</h3> 
<ul> 
 <li> <a href="jdbc-adapter/virtualschema-jdbc-adapter/src/main/java/com/exasol/adapter/dialects/SqlDialect.java"><code>com.exasol.adapter.dialects.SqlDialect</code></a> (implementation mandatory) 
  <ul> 
   <li>Define capabilities</li> 
   <li>Define which kind of support the dialect has for catalogs and schemas</li> 
  </ul> </li> 
 <li> <a href="jdbc-adapter/virtualschema-jdbc-adapter/src/main/java/com/exasol/adapter/jdbc/RemoteMetadataReader.java"><code>com.exasol.adapter.jdbc.RemoteMetadataReader</code></a> (optional depending on dialect) 
  <ul> 
   <li>Read top-level metadata</li> 
   <li>Locate tables</li> 
  </ul> </li> 
 <li> <a href="jdbc-adapter/virtualschema-jdbc-adapter/src/main/java/com/exasol/adapter/jdbc/TableMetadataReader.java"><code>com.exasol.adapter.jdbc.TableMetadataReader</code></a> (optional depending on dialect) 
  <ul> 
   <li>Decide which tables should be mapped</li> 
   <li>Map data on table level</li> 
  </ul> </li> 
 <li> <a href="jdbc-adapter/virtualschema-jdbc-adapter/src/main/java/com/exasol/adapter/jdbc/ColumnMetadataReader.java"><code>com.exasol.adapter.jdbc.ColumnMetadataReader</code></a> (optional depending on dialect) 
  <ul> 
   <li>Map data on column level</li> 
  </ul> </li> 
</ul> 
<h3> <a id="registering-the-dialect" class="anchor" href="#registering-the-dialect" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Registering the Dialect</h3> 
<p>The Virtual Schema adapter creates an instance of an SQL dialect on demand. You can pick any dialect that is listed in the <code>SqlDialects</code> registry.</p> 
<p>To register your new dialect add it to the list in <a href="../virtualschema-jdbc-adapter/src/main/resources/sql_dialects.properties">sql_dialects.properties</a>.</p> 
<div class="highlight highlight-source-ini">
 <pre><span class="pl-k">com.exasol.adapter.dialects.supported</span>=\
...
com.exasol.adapter.dialects.myawesomedialect.MyAweSomeSqlDialect</pre>
</div> 
<p>For tests or in case you want to exclude existing dialects in certain scenarios you can override the contents of this file by setting the system property <code>com.exasol.adapter.dialects.supported</code>.</p> 
<p>Please also remember to <a href="../.README.md.html">list the supported dialect in the documentation</a>. </p> 
<h3> <a id="setup-data-source" class="anchor" href="#setup-data-source" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup Data Source</h3> 
<ul> 
 <li>Setup and start the database</li> 
 <li>Testdata: Create a test schema with a simple table (simple data types)</li> 
</ul> 
<h3> <a id="setup-exasol" class="anchor" href="#setup-exasol" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup Exasol</h3> 
<ul> 
 <li>Setup and start an Exasol database with virtual schemas feature</li> 
 <li>Upload the JDBC drivers of the data source via EXAOperation</li> 
 <li>Manual test: query data from the data source via <code>IMPORT FROM JDBC</code> </li> 
</ul> 
<h3> <a id="catalog-schema--table-mapping" class="anchor" href="#catalog-schema--table-mapping" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Catalog, Schema &amp; Table Mapping</h3> 
<ul> 
 <li>Override the <code>SqlDialect</code> methods for catalog, schema and table mapping</li> 
 <li>Manual test: create a virtual schema by specifying the catalog and/or schema.</li> 
</ul> 
<h3> <a id="data-type-mapping" class="anchor" href="#data-type-mapping" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data Type Mapping</h3> 
<ul> 
 <li>Testdata: Create a table with all data types and at least one row of data</li> 
 <li>Override the <code>SqlDialect</code> method for data type mapping</li> 
 <li>Automatic test: sys tables show virtual table and columns with correctly mapped type</li> 
 <li>Automatic test: running <code>SELECT</code> on the virtual table returns the expected result</li> 
</ul> 
<h3> <a id="identifier-case-handling--quoting" class="anchor" href="#identifier-case-handling--quoting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Identifier Case Handling &amp; Quoting</h3> 
<ul> 
 <li>Testdata: Create a schema/table/column with mixed case (if supported)</li> 
 <li>Automatic test: sys tables correct</li> 
 <li>Automatic test: <code>SELECT</code> works as expected</li> 
</ul> 
<h3> <a id="projection-capability" class="anchor" href="#projection-capability" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Projection Capability</h3> 
<ul> 
 <li>Add capability</li> 
 <li>Automatic test: pushed down &amp; correct result (incl. <code>EXPLAIN VIRTUAL</code>). Also test with mixed case columns.</li> 
</ul> 
<h3> <a id="predicates-and-literal-capabilities" class="anchor" href="#predicates-and-literal-capabilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Predicates and Literal Capabilities</h3> 
<ul> 
 <li>Add capabilities for supported literals and predicates (e.g. <code>c1='foo'</code>)</li> 
 <li>Automatic test: pushed down &amp; correct result (incl. <code>EXPLAIN VIRTUAL</code>) for all predicates &amp; literals</li> 
</ul> 
<h3> <a id="aggregation--set-function-capabilities" class="anchor" href="#aggregation--set-function-capabilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Aggregation &amp; Set Function Capabilities</h3> 
<ul> 
 <li>Add capabilities for aggregations and aggregation functions</li> 
 <li>Automatic test: pushed down &amp; correct result (incl. <code>EXPLAIN VIRTUAL</code>) for all set functions</li> 
</ul> 
<h3> <a id="order-by--limit-capabilities" class="anchor" href="#order-by--limit-capabilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order By / Limit Capabilities</h3> 
<ul> 
 <li>Testdata: Create a table with null values and non-null values, to check null collation.</li> 
 <li>Add capabilities for order by and/or limit</li> 
 <li>Automatic test: pushed down &amp; correct result (incl. <code>EXPLAIN VIRTUAL</code>)</li> 
 <li>Automatic test: default null collation, explicit <code>NULLS FIRST/LAST</code> </li> 
</ul> 
<h3> <a id="scalar-function-capabilities" class="anchor" href="#scalar-function-capabilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scalar Function Capabilities</h3> 
<ul> 
 <li>Add capabilities for scalar functions</li> 
 <li>Automatic test: pushed down &amp; correct result (incl. <code>EXPLAIN VIRTUAL</code>)</li> 
</ul> 
<h3> <a id="views" class="anchor" href="#views" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Views</h3> 
<ul> 
 <li>Testdata: Create a simple view, e.g. joining two existing tables</li> 
 <li>Automatic test: Query the view, optionally e.g. with a filter.</li> 
</ul> 
<h2> <a id="integration-testing-with-containers" class="anchor" href="#integration-testing-with-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integration Testing with Containers</h2> 
<p>This integration test works fully automated, there are no manual steps in setting up the source database and the connection to EXASOL.</p> 
<h3> <a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h3> 
<p>The idea of the container based tests is:</p> 
<ul> 
 <li>Run the EXASOL and source databases in containers</li> 
 <li>Prepare the test schema in the source database</li> 
 <li>Create a virtual schema for the source database</li> 
 <li>Run the tests on the virtual schmema</li> 
</ul> 
<p><a href="images/integrationtest_overview.png" target="_blank" rel="noopener noreferrer"><img src="images/integrationtest_overview.png" alt="Integration test overview" style="max-width:100%;" /></a></p> 
<h3> <a id="prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h3> 
<p>What you need is, for each source database:</p> 
<ul> 
 <li>A docker image with user you can connect to</li> 
 <li>A JDBC driver for the database</li> 
</ul> 
<h3> <a id="preparing-integration-test" class="anchor" href="#preparing-integration-test" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preparing Integration Test</h3> 
<ol> 
 <li>In order to run the integration test automated, edit the <a href="../integration-test-data/integration-test-travis.yaml">Travis CI integration test configuration file</a> and add your new database.</li> 
 <li>Provide a JDBC driver JAR for the source database.</li> 
 <li>Add a new Integration Test class for you database</li> 
</ol> 
<h4> <a id="add-your-database-to-the-test-configuration" class="anchor" href="#add-your-database-to-the-test-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add Your Database to the Test Configuration</h4> 
<p>Set the following properties for your database:</p> 
<table> 
 <thead> 
  <tr> 
   <th>configuration property</th> 
   <th>explanation</th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr> 
   <td>runIntegrationTests</td> 
   <td>enable/disable your test (e.g. true)</td> 
  </tr> 
  <tr> 
   <td>jdbcDriverPath</td> 
   <td>path to the jdbc driver in bucketFS (e.g /buckets/bfsdefault/default/drivers/jdbc/POSTGRESQL/postgresql-42.2.5.jar;)</td> 
  </tr> 
  <tr> 
   <td>connectionString</td> 
   <td>connection string to connect to the source database from the integration test system, so use the exposed port (e.g. jdbc:postgresql://localhost:45432/postgres)</td> 
  </tr> 
  <tr> 
   <td>user</td> 
   <td>the database user</td> 
  </tr> 
  <tr> 
   <td>password</td> 
   <td>password for the database user</td> 
  </tr> 
  <tr> 
   <td>dockerImage</td> 
   <td>name of the docker image for the source db</td> 
  </tr> 
  <tr> 
   <td>dockerImageVersion</td> 
   <td>version of the used docker image (eg. latest)</td> 
  </tr> 
  <tr> 
   <td>dockerPortMapping</td> 
   <td>docker port mapping external_db_port:internal_db_port (e.g. 45432:5432)</td> 
  </tr> 
  <tr> 
   <td>dockerName</td> 
   <td>name for the docker container (e.g. testpg)</td> 
  </tr> 
  <tr> 
   <td>dockerConnectionString</td> 
   <td>connection string to connect to the source db from the EXASOL docker container. Use the constant DBHOST as hostname, this will be set to the actual internal docker network IP by the integration test skript during runtime (e.g. jdbc:postgresql://DBHOST:5432/postgres)</td> 
  </tr> 
 </tbody> 
</table> 
<h4> <a id="provide-jdbc-drivers-for-the-source-database" class="anchor" href="#provide-jdbc-drivers-for-the-source-database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Provide JDBC drivers for the Source Database</h4> 
<p>The JDBC drivers are automatically deployed during the test. You have to create a directory for the jdbc driver under integration-test-data/drivers. The folder contains the driver jar file(s) and a config file. See the <a href="../integration-test-data/drivers/POSTGRESQL/settings.cfg">PostgreSQL config</a> for an example.</p> 
<p>In order to connect to the source database from your integration test you also have to add the jdbc driver dependency to the <a href="../virtualschema-jdbc-adapter/pom.xml">POM</a> scope verify.</p> 
<h4> <a id="add-a-new-integration-test-class" class="anchor" href="#add-a-new-integration-test-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add a new Integration Test Class</h4> 
<p>Add a new class that derives from <a href="../virtualschema-jdbc-adapter/src/test/java/com/exasol/adapter/dialects/AbstractIntegrationTest.java">AbstractIntegrationTest</a>. This class has to:</p> 
<ul> 
 <li>Create the test schema in the source database</li> 
 <li>Create the virtual schema</li> 
 <li>Execute the tests on the virtual schema See <a href="../virtualschema-jdbc-adapter/src/test/java/com/exasol/adapter/dialects/postgresql/PostgreSQLDialectIT.java">PostgreSQLDialectIT</a> for an example.</li> 
</ul> 
<h3> <a id="executing-integration-tests" class="anchor" href="#executing-integration-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing Integration Tests</h3> 
<p>Executing the integration test is easy, just run the <a href="../integration-test-data/run_integration_tests.sh">integration test bash script</a></p> 
<h2> <a id="integration-testing-against-a-local-database" class="anchor" href="#integration-testing-against-a-local-database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integration Testing against a local database</h2> 
<p>If you don't have a container for the source database, you can test against a local database</p> 
<h3> <a id="security-considerations" class="anchor" href="#security-considerations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security Considerations</h3> 
<p>Please note that in the course of the integration tests you need to provide the test framework with access rights and credentials to the source database.</p> 
<p>In order not to create security issues:</p> 
<ul> 
 <li>Make sure the data in the source database is not confidential (demo data only)</li> 
 <li>Don't reuse credentials</li> 
 <li>Don't check in credentials</li> 
</ul> 
<h3> <a id="prerequisites-1" class="anchor" href="#prerequisites-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h3> 
<ul> 
 <li> <p>Exasol running</p> </li> 
 <li> <p>Exasol accessible from within integration test environment</p> </li> 
 <li> <p>Source database running</p> </li> 
 <li> <p>Source database accessible from within integration test environment</p> </li> 
 <li> <p>Test data loaded into source database</p> </li> 
 <li> <p><a href="https://www.exasol.com/support/browse/SOL-503?src=confmacro" rel="nofollow">BucketFS HTTP port listening and reachable</a> (e.g. on port 2580)</p> <p><a href="images/Screenshot_BucketFS_default_service.png" target="_blank" rel="noopener noreferrer"><img src="images/Screenshot_BucketFS_default_service.png" alt="BucketFS on port 2580" style="max-width:100%;" /></a></p> </li> 
 <li> <p>Bucket on BucketFS prepared for holding JDBC drivers and virtual schema adapter</p> <p><a href="images/Screenshot_bucket_for_JARs.png" target="_blank" rel="noopener noreferrer"><img src="images/Screenshot_bucket_for_JARs.png" alt="Integration test bucket" style="max-width:100%;" /></a></p> </li> 
 <li> <p>JDBC driver JAR archives available for databases against which to run integration tests</p> </li> 
</ul> 
<p>If BucketFS is new to you, there are nice <a href="https://www.exasol.com/portal/display/TRAINING/BucketFS" rel="nofollow">training videos on BucketFS</a> available.</p> 
<h3> <a id="preparing-integration-test-1" class="anchor" href="#preparing-integration-test-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preparing Integration Test</h3> 
<ol> 
 <li>Create a dedicated user in the source database that has the necessary access privileges</li> 
 <li>Create credentials for the user under which the integration tests run at the source</li> 
 <li>Make a local copy of the <a href="../integration-test-data/integration-test-sample.yaml">sample integration test configuration file</a> in a place where you don't accidentally check this file in.</li> 
 <li>Edit the credentials information</li> 
 <li> <a href=".deploying_the_virtual_schema_adapter.md.html#deploying-jdbc-driver-files">Deploy the JDBC driver(s)</a> to the prepared bucket in Exasol's BucketFS</li> 
</ol> 
<h4> <a id="creating-your-own-integration-test-configuration" class="anchor" href="#creating-your-own-integration-test-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Your own Integration Test Configuration</h4> 
<p>Directories called <code>local</code> are ignored by Git, so you can place your configuration there and avoid having it checked in.</p> 
<p>In the root directory of the adapter sources execute the following commands:</p> 
<div class="highlight highlight-source-shell">
 <pre>mkdir jdbc-adapter/local
cp jdbc-adapter/integration-test-data/integration-test-sample.yaml jdbc-adapter/local/integration-test-config.yaml</pre>
</div> 
<p>Now edit the file <code>jdbc-adapter/local/integration-test-config.yaml</code> to adapt the settings to your local installation.</p> 
<h3> <a id="executing-integration-tests-1" class="anchor" href="#executing-integration-tests-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing Integration Tests</h3> 
<p>We use following <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" rel="nofollow">Maven lifecycle phases</a> for our integration tests:</p> 
<ul> 
 <li> <code>pre-integration-test</code> phase is used to <strong>automatically deploy the latest <a href="https://www.exasol.com/support/secure/attachment/66315/EXASOL_JDBC-6.1.rc1.tar.gz" rel="nofollow">JDBC</a> adapter JAR</strong> (based on your latest code modifications)</li> 
 <li> <code>integration-test</code> phase is used to execute the actual integration tests</li> 
</ul> 
<p>Note that to check whether the integration-tests were successful, you have to run the verify Maven phase.</p> 
<p>You can start the integration tests as follows:</p> 
<div class="highlight highlight-source-shell">
 <pre>mvn clean package <span class="pl-k">&amp;&amp;</span> mvn verify -Pit -Dintegrationtest.configfile=/path/to/your/integration-test-config.yaml</pre>
</div> 
<p>This will run all integration tests, i.e. all JUnit tests with the suffix <code>IT</code> in the filename.</p> 
<p>The YAML configuration file stores the information for your test environment like JDBC connection strings, paths and credentials.</p> 
<h2> <a id="java-remote-debugging-of-adapter-script" class="anchor" href="#java-remote-debugging-of-adapter-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java Remote Debugging of Adapter script</h2> 
<p>When developing a new dialect it is sometimes really helpful to debug the deployed adapter script inside the database. In a one node Exasol environment setting up remote debugging is straight forward. First define the following <code>env</code> directive in your adapter script:</p> 
<div class="highlight highlight-source-sql">
 <pre>CREATE <span class="pl-k">OR</span> REPLACE JAVA ADAPTER SCRIPT <span class="pl-c1">adapter</span>.<span class="pl-c1">jdbc_adapter</span> 
  <span class="pl-k">AS</span>
  
  %env JAVA_TOOL_OPTIONS<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>-agentlib:jdwp=transport=dt_socket,server=y,address=8000,suspend=y<span class="pl-pds">&quot;</span></span>;

  <span class="pl-k">//</span> This is the class implementing the callback method of the adapter script
  %scriptclass <span class="pl-c1">com</span>.<span class="pl-c1">exasol</span>.<span class="pl-c1">adapter</span>.<span class="pl-c1">jdbc</span>.JdbcAdapter;

  <span class="pl-k">//</span> This will add the adapter jar to the classpath so that it can be used inside the adapter script
  <span class="pl-k">//</span> Replace the names of the bucketfs <span class="pl-k">and</span> the bucket with the ones you used.
  %jar <span class="pl-k">/</span>buckets<span class="pl-k">/</span>bucketfs1<span class="pl-k">/</span>bucket1<span class="pl-k">/</span>virtualschema<span class="pl-k">-</span>jdbc<span class="pl-k">-</span>adapter<span class="pl-k">-</span>dist<span class="pl-k">-</span><span class="pl-c1">1</span>.<span class="pl-c1">10</span>.<span class="pl-c1">0</span>.jar;
									 
  <span class="pl-k">//</span> You have to add all files of the data source jdbc driver here (<span class="pl-c1">e</span>.<span class="pl-c1">g</span>. MySQL <span class="pl-k">or</span> Hive)

  %jar <span class="pl-k">/</span>buckets<span class="pl-k">/</span>bucketfs1<span class="pl-k">/</span>bucket1<span class="pl-k">/</span>RedshiftJDBC42<span class="pl-k">-</span><span class="pl-c1">1</span>.<span class="pl-c1">2</span>.<span class="pl-c1">1</span>.<span class="pl-c1">1001</span>.jar;

<span class="pl-k">/</span></pre>
</div> 
<p>In eclipse (or any other Java IDE) you can then attach remotely to the Java Adapter using the IP of your one node Exasol environment and the port 8000.</p> 
<p>The switch <code>suspend=y</code> tells the Java-process to wait until the debugger connects to the Java UDF.</p> 
<h2> <a id="version-management" class="anchor" href="#version-management" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version Management</h2> 
<p>All dialects have the same version as the master project. In the master <code>pom.xml</code> file a property called <code>product-version</code> is set. Use this in as the artifact version number in the JDBC adapter and all dialects.</p> 
<p>Run the script</p> 
<div class="highlight highlight-source-shell">
 <pre>jdbc-adapter/tools/version.sh verify</pre>
</div> 
<p>To check that all documentation and templates reference the same version number. This script is also used as a build breaker in the continuous integration script.</p> 
<p>To update documentation files run</p> 
<div class="highlight highlight-source-shell">
 <pre>jdbc-adapter/tools/version.sh unify</pre>
</div> 
<p>Note that the script must be run from the root directory of the virtual schema project.</p>
</body>
</html>
